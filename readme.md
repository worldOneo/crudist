# CRUDist - APIs for gentleman
[![GoReport](https://goreportcard.com/badge/github.com/worldOneo/crudist)](https://goreportcard.com/report/github.com/worldOneo/crudist)  
Automagicaly create CRUD APIs for your data.

# V2 - New Thoughts
V1 of CRUDist is the anti-pattern hell itself.   
V2 Will focus on elegant codegeneration to generate feature rich CRUD APIs with good patterns which you controll.
**No handing over responsibilities, no hacky code.**

# CLI
The primary command is `crudist gen` to generate your `crudist.json` file to go-code.

# crudist.json

## API

```jsonc
// crudist.json
{
  "framework": "fiber",
  "endpoints": [
    {
      "package": "app",
      "base_path": "api/v1",
      "data_type": "mystruct.MyStruct",
      "name": "my_struct",
      "upper_name": "MyStruct",
			"imports": [ "github.com/me/myproject/mystruct" ],
      "operators": [
        "CREATE",
        "READ",
        "UPDATE",
        "DELETE"
      ]
    }
  ]
}

```
<details>
  <summary>Generates this code:</summary>

  ```go
  // app_my_struct.crudist.go
  // Code generated by "crudist gen"; DO NOT EDIT.
  package app

  import (
    "github.com/gofiber/fiber/v2"
    "github.com/me/myproject/mystruct" 
  )

  type MyStructStorage interface {
    Create(ctx *fiber.Ctx, data *mystruct.MyStruct) error
    Read(ctx *fiber.Ctx, id string) (*mystruct.MyStruct, error)
    ReadAll(ctx *fiber.Ctx) ([]mystruct.MyStruct, error)
    Update(ctx *fiber.Ctx, id string, data *mystruct.MyStruct) error
    Delete(ctx *fiber.Ctx, id string, data *mystruct.MyStruct) error
  }

  type MyStructHandler struct {
    storage MyStructStorage
  }

  func NewMyStructHandler(storage MyStructStorage) *MyStructHandler {
    return &MyStructHandler{storage}
  }

  func (handler *MyStructHandler) RegisterHandlers(app *fiber.App) {
    errOrJson := func (ctx *fiber.Ctx, err error, data *interface{}) error {
      if err != nil {
        return err
      }
      return ctx.JSON(data)
    }
    a := handler.storage
    
    app.Get("api/v1/my_struct", func(c *fiber.Ctx) error {
      data, err := a.ReadAll(c)
      return errOrJson(c,err,data)
    })
    app.Get("api/v1/my_struct/:id", func(c *fiber.Ctx) error {
      data, err := a.Read(c, c.Params("id"))
      return errOrJson(c,err,data)
    })
    app.Post("api/v1/my_struct", func(c *fiber.Ctx) error {
      data := mystruct.MyStruct{}
      err := c.BodyParser(&data)
      if err != nil {
        return err
      }
      err = a.Create(c, &data)
      return errOrJson(c,err,data)
    })
    app.Patch("api/v1/my_struct/:id", func(c *fiber.Ctx) error {
      data := mystruct.MyStruct{}
      err := c.BodyParser(&data)
      id := c.Params("id")
      if err != nil {
        return err
      }
      err = a.Update(c, id, &data)
      return errOrJson(c,err,data)
    })
    app.Delete("api/v1/my_struct/:id", func(c *fiber.Ctx) error {
      data := mystruct.MyStruct{}
      err := c.BodyParser(&data)
      id := c.Params("id")
      if err != nil {
        return err
      }
      err = a.Delete(c, id, &data)
      return errOrJson(c,err,data)
    })
  }
  ```
</details>

## Errors

```jsonc
// crudist.json
{
  "errors": {
    "package": "errors",
    "errors": [
      {
        "name": "ConfigRead",
        "short": "CONFIG READ",
        "message": "failed to read the config file %s: %v",
        "parameters": [
          "string",
          "error"
        ]
      },
      {
        "name": "ConfigParse",
        "short": "BAD CONFIG",
        "message": "failed to parse the config: %v",
        "parameters": [
          "error"
        ]
      },
    ]
  }
}
```
<details>
  <summary>Generates this code:</summary>

  ```go
  // Code generated by "crudist gen"; DO NOT EDIT.
  package errors

  import (
    "fmt"
  )


  // ConfigReadError error type
  type ConfigReadError struct {
    Message string
  }

  func (C ConfigReadError) Error() string {
    return C.Message
  }

  func (C ConfigReadError) ErrorId() int {
    return 0
  }

  // NewConfigReadError creates a new ConfigReadError
  func NewConfigReadError(arg0 string,arg1 error,) error {
    return ConfigReadError{
      fmt.Sprintf("(CONFIG READ | Id: 0) failed to read the config file %s: %v", arg0,arg1,),
    }
  }


  // ConfigParseError error type
  type ConfigParseError struct {
    Message string
  }

  func (C ConfigParseError) Error() string {
    return C.Message
  }

  func (C ConfigParseError) ErrorId() int {
    return 1
  }

  // NewConfigParseError creates a new ConfigParseError
  func NewConfigParseError(arg0 error,) error {
    return ConfigParseError{
      fmt.Sprintf("(BAD CONFIG | Id: 1) failed to parse the config: %v", arg0,),
    }
  }
  ```
</details>

## Currently supported
To get support for your favourite Web or Model Framework open an issue.
### Web Frameworks:
  * [x] Fiber
  * [ ] Gin

### Model Frameworks:
  * [ ] GORM

Result routes:
```sh
GET    /user/
GET    /user/:id/
POST   /user/
DELETE /user/:id/
PATCH  /user/
```